<!DOCTYPE html>
<html lang="en" layout:decorate="~{layout/default}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<div class="main" layout:fragment="content">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-6">
        <h2 class="mt-5 mb-5"
            style="font-weight:700; color: #0a58ca;">
          ğŸ‘¨â€ğŸ«ë©˜í† ë“±ë¡
          í˜ì´ì§€</h2>
        <form action="/mentors/register" method="get" th:object="${mentorRegisterInfo}">
          <div class="mb-3">
            <label class="form-label" for="companyEmail">ì´ë©”ì¼</label>
            <input class="form-control" id="companyEmail" name="companyEmail" placeholder="ì‚¬ë‚´ ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”."
                   th:field="*{companyEmail}"
                   th:name="companyEmail"
                   type="email">
            <div th:errors="*{companyEmail}" th:if="${#fields.hasErrors('companyEmail')}">please check it
              again
            </div>
            <button class="btn" id="btnEmailSend" style="background-color: #0a58ca; color:white;">SEND EMAIL
            </button>
          </div>
          <div class="mb-3">
            <label class="form-label" for="emailCheck">ì´ë©”ì¼ ì¸ì¦</label>
            <input class="form-control" id="emailCheck" name="emailCheck" placeholder="ì¸ì¦í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”." type="text">
            <button class="btn" id="btnEmailCheck" style="background-color: #0a58ca; color:white;">VERIFY EMAIL</button>
          </div>
          <div class="d-flex justify-content-center mt-5">
            <button class="btn" id="btnSubmit" style="background-color:#0a58ca; color:white;">NEXT</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <script>
    let emailVerified = false;
    $("#btnEmailSend").on("click", function(e) {
      $.ajax({
        url : "/mentors/register/email/send",
        data : {
          receiver : $("#companyEmail").val(),
        },
        method: "post",
        success : function(data) {
          console.log(data);
          if (data === "success") {
            alert("ì´ë©”ì¼ì„ ì „ì†¡í•˜ì˜€ìŠµë‹ˆë‹¤.");
          }
          else {
            alert("ì´ë©”ì¼ ì „ì†¡ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤");
          }
        },
        complete : function(data) {
          console.log("complete");
          console.log(data);
        },
      });
    return false;
    });

    $("#btnEmailCheck").on("click", function(e) {
      $.ajax({
        url : "/mentors/register/email/auth",
        data : {
          userEmailCode : $("#emailCheck").val(),
        },
        method: "post",
        success : function(data) {
          console.log(data);
          if (data === "success") {
            alert("ì´ë©”ì¼ ì¸ì¦ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤.");
            emailVerified = true;
            $("#btnEmailSend").attr("readonly", true);
            $("#btnEmailCheck").attr("readonly", true);
            $("#btnEmailSend").attr("disabled", true);
            $("#btnEmailCheck").attr("disabled", true);
          }
          else {
            alert("ì´ë©”ì¼ ì¸ì¦ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.");
          }
        },
        complete : function(data) {
          console.log("complete");
          console.log(data);
        },
      });
    return false;
    });
    $("#btnSubmit").on("click", function(e) {
      if($("#companyEmail").val() === "") {
        alert("ì´ë©”ì¼ ì…ë ¥ì€ í•„ìˆ˜ì‚¬í•­ì´ì—ìš”.");
        return false;
      }
      if(emailVerified === false) {
        alert("ì´ë©”ì¼ ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.");
        return false;
      }
    });
  </script>
</div>
</html>